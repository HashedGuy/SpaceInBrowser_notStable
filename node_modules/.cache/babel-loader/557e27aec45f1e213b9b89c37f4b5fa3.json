{"ast":null,"code":"import { Vector3, Vector2, Triangle, DoubleSide, BackSide } from 'three'; // Ripped and modified From THREE.js Mesh raycast\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L115\n\nvar vA = /* @__PURE__ */new Vector3();\nvar vB = /* @__PURE__ */new Vector3();\nvar vC = /* @__PURE__ */new Vector3();\nvar uvA = /* @__PURE__ */new Vector2();\nvar uvB = /* @__PURE__ */new Vector2();\nvar uvC = /* @__PURE__ */new Vector2();\nvar intersectionPoint = /* @__PURE__ */new Vector3();\n\nfunction checkIntersection(ray, pA, pB, pC, point, side) {\n  var intersect;\n\n  if (side === BackSide) {\n    intersect = ray.intersectTriangle(pC, pB, pA, true, point);\n  } else {\n    intersect = ray.intersectTriangle(pA, pB, pC, side !== DoubleSide, point);\n  }\n\n  if (intersect === null) return null;\n  var distance = ray.origin.distanceTo(point);\n  return {\n    distance: distance,\n    point: point.clone()\n  };\n}\n\nfunction checkBufferGeometryIntersection(ray, position, uv, a, b, c, side) {\n  vA.fromBufferAttribute(position, a);\n  vB.fromBufferAttribute(position, b);\n  vC.fromBufferAttribute(position, c);\n  var intersection = checkIntersection(ray, vA, vB, vC, intersectionPoint, side);\n\n  if (intersection) {\n    if (uv) {\n      uvA.fromBufferAttribute(uv, a);\n      uvB.fromBufferAttribute(uv, b);\n      uvC.fromBufferAttribute(uv, c);\n      intersection.uv = Triangle.getUV(intersectionPoint, vA, vB, vC, uvA, uvB, uvC, new Vector2());\n    }\n\n    var face = {\n      a: a,\n      b: b,\n      c: c,\n      normal: new Vector3(),\n      materialIndex: 0\n    };\n    Triangle.getNormal(vA, vB, vC, face.normal);\n    intersection.face = face;\n    intersection.faceIndex = a;\n  }\n\n  return intersection;\n} // https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L258\n\n\nfunction intersectTri(geo, side, ray, tri, intersections) {\n  var triOffset = tri * 3;\n  var a = geo.index.getX(triOffset);\n  var b = geo.index.getX(triOffset + 1);\n  var c = geo.index.getX(triOffset + 2);\n  var intersection = checkBufferGeometryIntersection(ray, geo.attributes.position, geo.attributes.uv, a, b, c, side);\n\n  if (intersection) {\n    intersection.faceIndex = tri;\n    if (intersections) intersections.push(intersection);\n    return intersection;\n  }\n\n  return null;\n}\n\nexport { intersectTri };","map":{"version":3,"sources":["/Users/arbus/Documents/SpaceInBrowser/node_modules/three-mesh-bvh/src/utils/ThreeRayIntersectUtilities.js"],"names":["Vector3","Vector2","Triangle","DoubleSide","BackSide","vA","vB","vC","uvA","uvB","uvC","intersectionPoint","checkIntersection","ray","pA","pB","pC","point","side","intersect","intersectTriangle","distance","origin","distanceTo","clone","checkBufferGeometryIntersection","position","uv","a","b","c","fromBufferAttribute","intersection","getUV","face","normal","materialIndex","getNormal","faceIndex","intersectTri","geo","tri","intersections","triOffset","index","getX","attributes","push"],"mappings":"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","sourcesContent":["import { Vector3, Vector2, Triangle, DoubleSide, BackSide } from 'three';\r\n\r\n// Ripped and modified From THREE.js Mesh raycast\r\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L115\r\nconst vA = /* @__PURE__ */ new Vector3();\r\nconst vB = /* @__PURE__ */ new Vector3();\r\nconst vC = /* @__PURE__ */ new Vector3();\r\n\r\nconst uvA = /* @__PURE__ */ new Vector2();\r\nconst uvB = /* @__PURE__ */ new Vector2();\r\nconst uvC = /* @__PURE__ */ new Vector2();\r\n\r\nconst intersectionPoint = /* @__PURE__ */ new Vector3();\r\nfunction checkIntersection( ray, pA, pB, pC, point, side ) {\r\n\r\n\tlet intersect;\r\n\tif ( side === BackSide ) {\r\n\r\n\t\tintersect = ray.intersectTriangle( pC, pB, pA, true, point );\r\n\r\n\t} else {\r\n\r\n\t\tintersect = ray.intersectTriangle( pA, pB, pC, side !== DoubleSide, point );\r\n\r\n\t}\r\n\r\n\tif ( intersect === null ) return null;\r\n\r\n\tconst distance = ray.origin.distanceTo( point );\r\n\r\n\treturn {\r\n\r\n\t\tdistance: distance,\r\n\t\tpoint: point.clone(),\r\n\r\n\t};\r\n\r\n}\r\n\r\nfunction checkBufferGeometryIntersection( ray, position, uv, a, b, c, side ) {\r\n\r\n\tvA.fromBufferAttribute( position, a );\r\n\tvB.fromBufferAttribute( position, b );\r\n\tvC.fromBufferAttribute( position, c );\r\n\r\n\tconst intersection = checkIntersection( ray, vA, vB, vC, intersectionPoint, side );\r\n\r\n\tif ( intersection ) {\r\n\r\n\t\tif ( uv ) {\r\n\r\n\t\t\tuvA.fromBufferAttribute( uv, a );\r\n\t\t\tuvB.fromBufferAttribute( uv, b );\r\n\t\t\tuvC.fromBufferAttribute( uv, c );\r\n\r\n\t\t\tintersection.uv = Triangle.getUV( intersectionPoint, vA, vB, vC, uvA, uvB, uvC, new Vector2( ) );\r\n\r\n\t\t}\r\n\r\n\t\tconst face = {\r\n\t\t\ta: a,\r\n\t\t\tb: b,\r\n\t\t\tc: c,\r\n\t\t\tnormal: new Vector3(),\r\n\t\t\tmaterialIndex: 0\r\n\t\t};\r\n\r\n\t\tTriangle.getNormal( vA, vB, vC, face.normal );\r\n\r\n\t\tintersection.face = face;\r\n\t\tintersection.faceIndex = a;\r\n\r\n\t}\r\n\r\n\treturn intersection;\r\n\r\n}\r\n\r\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L258\r\nfunction intersectTri( geo, side, ray, tri, intersections ) {\r\n\r\n\tconst triOffset = tri * 3;\r\n\tconst a = geo.index.getX( triOffset );\r\n\tconst b = geo.index.getX( triOffset + 1 );\r\n\tconst c = geo.index.getX( triOffset + 2 );\r\n\r\n\tconst intersection = checkBufferGeometryIntersection( ray, geo.attributes.position, geo.attributes.uv, a, b, c, side );\r\n\r\n\tif ( intersection ) {\r\n\r\n\t\tintersection.faceIndex = tri;\r\n\t\tif ( intersections ) intersections.push( intersection );\r\n\t\treturn intersection;\r\n\r\n\t}\r\n\r\n\treturn null;\r\n\r\n}\r\n\r\nexport { intersectTri };\r\n"]},"metadata":{},"sourceType":"module"}