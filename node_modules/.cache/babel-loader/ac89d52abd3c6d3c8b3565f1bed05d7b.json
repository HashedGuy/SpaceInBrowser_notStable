{"ast":null,"code":"import _classCallCheck from \"/Users/arbus/Documents/SpaceInBrowser/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/arbus/Documents/SpaceInBrowser/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/arbus/Documents/SpaceInBrowser/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/arbus/Documents/SpaceInBrowser/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { Loader, FileLoader } from 'three';\nimport * as Nodes from '../nodes/Nodes.js';\n\nvar NodeMaterialLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(NodeMaterialLoader, _Loader);\n\n  var _super = _createSuper(NodeMaterialLoader);\n\n  function NodeMaterialLoader(manager) {\n    var _this;\n\n    var library = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, NodeMaterialLoader);\n\n    _this = _super.call(this, manager);\n    _this.nodes = {};\n    _this.materials = {};\n    _this.passes = {};\n    _this.names = {};\n    _this.library = library;\n    return _this;\n  }\n\n  _createClass(NodeMaterialLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var loader = new FileLoader(scope.manager);\n      loader.setPath(scope.path);\n      loader.load(url, function (text) {\n        onLoad(scope.parse(JSON.parse(text)));\n      }, onProgress, onError);\n      return this;\n    }\n  }, {\n    key: \"getObjectByName\",\n    value: function getObjectByName(uuid) {\n      return this.names[uuid];\n    }\n  }, {\n    key: \"getObjectById\",\n    value: function getObjectById(uuid) {\n      return this.library[uuid] || this.nodes[uuid] || this.materials[uuid] || this.passes[uuid] || this.names[uuid];\n    }\n  }, {\n    key: \"getNode\",\n    value: function getNode(uuid) {\n      var object = this.getObjectById(uuid);\n\n      if (!object) {\n        console.warn('Node \"' + uuid + '\" not found.');\n      }\n\n      return object;\n    }\n  }, {\n    key: \"resolve\",\n    value: function resolve(json) {\n      switch (typeof json) {\n        case 'boolean':\n        case 'number':\n          return json;\n\n        case 'string':\n          if (/^\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}$/i.test(json) || this.library[json]) {\n            return this.getNode(json);\n          }\n\n          return json;\n\n        default:\n          if (Array.isArray(json)) {\n            for (var i = 0; i < json.length; i++) {\n              json[i] = this.resolve(json[i]);\n            }\n          } else {\n            for (var prop in json) {\n              if (prop === 'uuid') continue;\n              json[prop] = this.resolve(json[prop]);\n            }\n          }\n\n      }\n\n      return json;\n    }\n  }, {\n    key: \"declare\",\n    value: function declare(json) {\n      var uuid, node, object;\n\n      for (uuid in json.nodes) {\n        node = json.nodes[uuid];\n        object = new Nodes[node.nodeType + 'Node']();\n\n        if (node.name) {\n          object.name = node.name;\n          this.names[object.name] = object;\n        }\n\n        this.nodes[uuid] = object;\n      }\n\n      for (uuid in json.materials) {\n        node = json.materials[uuid];\n        object = new Nodes[node.type]();\n\n        if (node.name) {\n          object.name = node.name;\n          this.names[object.name] = object;\n        }\n\n        this.materials[uuid] = object;\n      }\n\n      for (uuid in json.passes) {\n        node = json.passes[uuid];\n        object = new Nodes[node.type]();\n\n        if (node.name) {\n          object.name = node.name;\n          this.names[object.name] = object;\n        }\n\n        this.passes[uuid] = object;\n      }\n\n      if (json.material) this.material = this.materials[json.material];\n      if (json.pass) this.pass = this.passes[json.pass];\n      return json;\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(json) {\n      var uuid;\n      json = this.resolve(this.declare(json));\n\n      for (uuid in json.nodes) {\n        this.nodes[uuid].copy(json.nodes[uuid]);\n      }\n\n      for (uuid in json.materials) {\n        this.materials[uuid].copy(json.materials[uuid]);\n      }\n\n      for (uuid in json.passes) {\n        this.passes[uuid].copy(json.passes[uuid]);\n      }\n\n      return this.material || this.pass || this;\n    }\n  }]);\n\n  return NodeMaterialLoader;\n}(Loader);\n\nvar NodeMaterialLoaderUtils = /*#__PURE__*/function () {\n  function NodeMaterialLoaderUtils() {\n    _classCallCheck(this, NodeMaterialLoaderUtils);\n  }\n\n  _createClass(NodeMaterialLoaderUtils, null, [{\n    key: \"replaceUUIDObject\",\n    value: function replaceUUIDObject(object, uuid, value, recursive) {\n      recursive = recursive !== undefined ? recursive : true;\n      if (typeof uuid === 'object') uuid = uuid.uuid;\n\n      if (typeof object === 'object') {\n        var keys = Object.keys(object);\n\n        for (var i = 0; i < keys.length; i++) {\n          var key = keys[i];\n\n          if (recursive) {\n            object[key] = this.replaceUUIDObject(object[key], uuid, value);\n          }\n\n          if (key === uuid) {\n            object[uuid] = object[key];\n            delete object[key];\n          }\n        }\n      }\n\n      return object === uuid ? value : object;\n    }\n  }, {\n    key: \"replaceUUID\",\n    value: function replaceUUID(json, uuid, value) {\n      this.replaceUUIDObject(json, uuid, value, false);\n      this.replaceUUIDObject(json.nodes, uuid, value);\n      this.replaceUUIDObject(json.materials, uuid, value);\n      this.replaceUUIDObject(json.passes, uuid, value);\n      this.replaceUUIDObject(json.library, uuid, value, false);\n      return json;\n    }\n  }]);\n\n  return NodeMaterialLoaderUtils;\n}();\n\nexport { NodeMaterialLoader, NodeMaterialLoaderUtils };","map":{"version":3,"sources":["/Users/arbus/Documents/SpaceInBrowser/node_modules/three-stdlib/loaders/NodeMaterialLoader.js"],"names":["Loader","FileLoader","Nodes","NodeMaterialLoader","manager","library","nodes","materials","passes","names","url","onLoad","onProgress","onError","scope","loader","setPath","path","load","text","parse","JSON","uuid","object","getObjectById","console","warn","json","test","getNode","Array","isArray","i","length","resolve","prop","node","nodeType","name","type","material","pass","declare","copy","NodeMaterialLoaderUtils","value","recursive","undefined","keys","Object","key","replaceUUIDObject"],"mappings":"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","sourcesContent":["import { Loader, FileLoader } from 'three';\nimport * as Nodes from '../nodes/Nodes.js';\n\nclass NodeMaterialLoader extends Loader {\n  constructor(manager, library = {}) {\n    super(manager);\n    this.nodes = {};\n    this.materials = {};\n    this.passes = {};\n    this.names = {};\n    this.library = library;\n  }\n\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.load(url, function (text) {\n      onLoad(scope.parse(JSON.parse(text)));\n    }, onProgress, onError);\n    return this;\n  }\n\n  getObjectByName(uuid) {\n    return this.names[uuid];\n  }\n\n  getObjectById(uuid) {\n    return this.library[uuid] || this.nodes[uuid] || this.materials[uuid] || this.passes[uuid] || this.names[uuid];\n  }\n\n  getNode(uuid) {\n    const object = this.getObjectById(uuid);\n\n    if (!object) {\n      console.warn('Node \"' + uuid + '\" not found.');\n    }\n\n    return object;\n  }\n\n  resolve(json) {\n    switch (typeof json) {\n      case 'boolean':\n      case 'number':\n        return json;\n\n      case 'string':\n        if (/^\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}$/i.test(json) || this.library[json]) {\n          return this.getNode(json);\n        }\n\n        return json;\n\n      default:\n        if (Array.isArray(json)) {\n          for (let i = 0; i < json.length; i++) {\n            json[i] = this.resolve(json[i]);\n          }\n        } else {\n          for (const prop in json) {\n            if (prop === 'uuid') continue;\n            json[prop] = this.resolve(json[prop]);\n          }\n        }\n\n    }\n\n    return json;\n  }\n\n  declare(json) {\n    let uuid, node, object;\n\n    for (uuid in json.nodes) {\n      node = json.nodes[uuid];\n      object = new Nodes[node.nodeType + 'Node']();\n\n      if (node.name) {\n        object.name = node.name;\n        this.names[object.name] = object;\n      }\n\n      this.nodes[uuid] = object;\n    }\n\n    for (uuid in json.materials) {\n      node = json.materials[uuid];\n      object = new Nodes[node.type]();\n\n      if (node.name) {\n        object.name = node.name;\n        this.names[object.name] = object;\n      }\n\n      this.materials[uuid] = object;\n    }\n\n    for (uuid in json.passes) {\n      node = json.passes[uuid];\n      object = new Nodes[node.type]();\n\n      if (node.name) {\n        object.name = node.name;\n        this.names[object.name] = object;\n      }\n\n      this.passes[uuid] = object;\n    }\n\n    if (json.material) this.material = this.materials[json.material];\n    if (json.pass) this.pass = this.passes[json.pass];\n    return json;\n  }\n\n  parse(json) {\n    let uuid;\n    json = this.resolve(this.declare(json));\n\n    for (uuid in json.nodes) {\n      this.nodes[uuid].copy(json.nodes[uuid]);\n    }\n\n    for (uuid in json.materials) {\n      this.materials[uuid].copy(json.materials[uuid]);\n    }\n\n    for (uuid in json.passes) {\n      this.passes[uuid].copy(json.passes[uuid]);\n    }\n\n    return this.material || this.pass || this;\n  }\n\n}\n\nclass NodeMaterialLoaderUtils {\n  static replaceUUIDObject(object, uuid, value, recursive) {\n    recursive = recursive !== undefined ? recursive : true;\n    if (typeof uuid === 'object') uuid = uuid.uuid;\n\n    if (typeof object === 'object') {\n      const keys = Object.keys(object);\n\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i];\n\n        if (recursive) {\n          object[key] = this.replaceUUIDObject(object[key], uuid, value);\n        }\n\n        if (key === uuid) {\n          object[uuid] = object[key];\n          delete object[key];\n        }\n      }\n    }\n\n    return object === uuid ? value : object;\n  }\n\n  static replaceUUID(json, uuid, value) {\n    this.replaceUUIDObject(json, uuid, value, false);\n    this.replaceUUIDObject(json.nodes, uuid, value);\n    this.replaceUUIDObject(json.materials, uuid, value);\n    this.replaceUUIDObject(json.passes, uuid, value);\n    this.replaceUUIDObject(json.library, uuid, value, false);\n    return json;\n  }\n\n}\n\nexport { NodeMaterialLoader, NodeMaterialLoaderUtils };\n"]},"metadata":{},"sourceType":"module"}